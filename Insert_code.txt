const fs = require('fs');
const csv = require('csv-parser');
const { createObjectCsvWriter } = require('csv-writer');

const inputFilePath = 'input.csv';
const outputFilePath = 'output.csv';

const csvWriter = createObjectCsvWriter({
  path: outputFilePath,
  header: [
    { id: 'start_date', title: 'start_date' }
  ]
});

const results = [];

fs.createReadStream(inputFilePath)
  .pipe(csv())
  .on('data', (row) => {
    // Assuming 'start_date' is the column containing dates
    const formattedDate = new Date(row.start_date).toISOString().replace('T', ' ').replace(/\.\d{3}Z/, '');
    results.push({ start_date: formattedDate });
  })
  .on('end', () => {
    csvWriter.writeRecords(results)
      .then(() => {
        console.log(`CSV file '${outputFilePath}' has been written with formatted dates.`);
      })
      .catch((error) => {
        console.error('Error writing CSV:', error);
      });
  });
